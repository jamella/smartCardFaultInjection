from Crypto.Signature import PKCS1_v1_5
from Crypto.Hash import SHA
from Crypto.PublicKey import RSA
import gmpy2
from gmpy2 import mpz

'''
#this section creates a signature and verifies it

testHash=SHA.new(('0102030405').decode('hex'))
print testHash.hexdigest()
testKey=RSA.generate(2048)
testSigner=PKCS1_v1_5.new(testKey)
testSignature=testSigner.sign(testHash)
print testSignature.encode('hex')

testHash2=SHA.new(('0102030405').decode('hex'))
testVerifier=PKCS1_v1_5.new(testKey)
print testHash2.hexdigest()
if(testVerifier.verify(testHash2,testSignature)):
    print('test signature verifies')
else:
    print('test signature does not verify')
'''

#these variables need to be changed based on the private and public keys teh applet 
#	is using in testing

ModulusInHex='9AE301CACCCCBA80202F1A2E34D1C4A01E7D1C4D5BCDB2A8ADBFEA8DFAB38888A6D19360BF28EB3F6FF02FCE9874B8F9BD032F18B65B6287D58EF3EF6614AE89D5361526631FA7AE462FFECE494867A7C5F2062716D05C444DD3E94F3097FC5E15409BE354344C7DD8012CB28C0DB03A5EEC72FA15D95D21FF850D1B1F1D304B49E701616BB63D5CF0FDC2BC6E1DEA82F32C2F97FA08C3F6AA8762DCEED57F7A1F938F9A0A1917DE0348E30D9DA77E9B052989FC713946C601E1DF668C7F26B1A4EEADFB777275BA6083831D345C502686DC3760DE98091BF425E233F70C64FE3EEE94724A3B2A5438C50D84EED04D528FE65CF78B35D9FBD89F6CBB4A7FBEE1'
pubKeyInHex='010001'

Modulus= long(ModulusInHex,16)
pubKey = long(pubKeyInHex,16)
#print Modulus
#print pubKey

message=('0102030405'.decode('hex'))
publicKeyTuple=(Modulus,pubKey)
hash=SHA.new(message)
key=RSA.construct(publicKeyTuple)
checker=PKCS1_v1_5.new(key)

hexSignature='303E6F3D8608AC0367B475E1B718DD77DF7BBE03929B6AD8B1561CB034724E209D6D4B7578C35997503EE5521BC6CE207E648159B86FDDA6A56B1610AEE1E5224657350AD1EC2EC209EE9D34006A4C9CFFD48B0E761B2324F91600E4B4B35DAAAB2D35217A6B4E790F6B6399E00D95BABF02ECC231C28D41903C08F6701EFBC211353470AC41A8E71BBEF9340D735C4275610356432052579A646842ECA5AC08049F7C8550C5D627D5B594D057115E72267250509D53F04EE5677C9788FE26685A826F1D180B0472C60933342E81C313783BCCA5780C36D4F3BE24003ECCEB75256714A8181CDB9DA6D19BC21FDDE3AD6FEFD16C290BC4407173850D23D73211'
nonHexSignature=hexSignature.decode('hex')

boolVal = checker.verify(hash,nonHexSignature)
if(boolVal):
    print('verifies')
else:
    print('does not verify')
